unit SEARCH_FLIGHT_U;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.DateUtils,
  System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.Grids, Vcl.DBGrids,
  rDBGrid, Vcl.StdCtrls, Vcl.Buttons, Vcl.WinXPickers, Vcl.ExtCtrls,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  rdlg;

type
  Tf_search_flight = class(TForm)
    p_title: TPanel;
    grb_date: TGroupBox;
    grb_list: TGroupBox;
    dp1: TDatePicker;
    bt_search: TBitBtn;
    rDBGrid1: TrDBGrid;
    q_get_flight: TFDQuery;
    procedure bt_searchClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  f_search_flight: Tf_search_flight;

implementation

{$R *.dfm}

uses
  Main;

procedure Tf_search_flight.bt_searchClick(Sender: TObject);
var
  selectedDate: TDate;
  day: Word;
begin
  selectedDate := dp1.Date;

  with q_get_flight do
  begin
    Close;
    ParamByName('MARCA_P').AsString := PRINCIPALE.etopic.Text;
    ParamByName('DAY_P').AsInteger := dayof(selectedDate);
    ParamByName('MONTH_P').AsInteger := monthof(selectedDate);
    ParamByName('YEAR_P').AsInteger := yearof(selectedDate);
    Open;
  end;

  if (q_get_flight.RecordCount = 0) then
  begin
    dlgi('Nessun volo presente.');

  end;
end;

procedure Tf_search_flight.FormShow(Sender: TObject);
begin
  dp1.Date := now;
end;

end.
